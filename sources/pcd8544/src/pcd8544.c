#include "globalincludefile.h"
#include "pcd8544_portmacro.h"
#include "pcd8544.h"



const uint8_t small_num[][4] = {
    {0x0e,0x15,0x0e,0x00}, // 48, zero
    {0x12,0x1f,0x10,0x00}, // 49, one
    {0x12,0x19,0x16,0x00}, // 50, two
    {0x11,0x15,0x0b,0x00}, // 51, three
    {0x07,0x04,0x1f,0x00}, // 52, four
    {0x17,0x15,0x09,0x00}, // 53, five
    {0x0e,0x15,0x09,0x00}, // 54, six
    {0x19,0x05,0x03,0x00}, // 55, seven
    {0x1a,0x15,0x0b,0x00}, // 56, eight
    {0x12,0x15,0x0e,0x00}, // 57, nine
    {0x00,0x10,0x00,0x00}, // 46, period
};
/*---------------------------------------------------------------------------*/
const uint8_t font6x8 [][5]  =  {
    {0x00,0x00,0x00,0x00,0x00,}, // ' ' 32
    {0x00,0x00,0x5F,0x00,0x00,}, // '!' 33
    {0x00,0x07,0x00,0x07,0x00,}, // '"' 34
    {0x14,0x7F,0x14,0x7F,0x14,}, // '#' 35
    {0x24,0x2A,0x7F,0x2A,0x12,}, // '$' 36
    {0x23,0x13,0x08,0x64,0x62,}, // '%' 37
    {0x36,0x49,0x55,0x22,0x50,}, // '&' 38
    {0x00,0x05,0x03,0x00,0x00,}, // ''' 39
    {0x00,0x1C,0x22,0x41,0x00,}, // '(' 40
    {0x00,0x41,0x22,0x1C,0x00,}, // ')' 41
    {0x14,0x08,0x3E,0x08,0x14,}, // '*' 42
    {0x08,0x08,0x3E,0x08,0x08,}, // '+' 43
    {0x00,0x50,0x30,0x00,0x00,}, // ',' 44
    {0x08,0x08,0x08,0x08,0x08,}, // '-' 45
    {0x00,0x60,0x60,0x00,0x00,}, // '.' 46
    {0x20,0x10,0x08,0x04,0x02,}, // '/' 47
    {0x3E,0x51,0x49,0x45,0x3E,}, // '0' 48
    {0x00,0x42,0x7F,0x40,0x00,}, // '1' 49
    {0x42,0x61,0x51,0x49,0x46,}, // '2' 50
    {0x21,0x41,0x45,0x4B,0x31,}, // '3' 51
    {0x18,0x14,0x12,0x7F,0x10,}, // '4' 52
    {0x27,0x45,0x45,0x45,0x39,}, // '5' 53
    {0x3C,0x4A,0x49,0x49,0x30,}, // '6' 54
    {0x03,0x01,0x71,0x09,0x07,}, // '7' 55
    {0x36,0x49,0x49,0x49,0x36,}, // '8' 56
    {0x06,0x49,0x49,0x29,0x16,}, // '9' 57
    {0x00,0x36,0x36,0x00,0x00,}, // ':' 58
    {0x00,0x56,0x36,0x00,0x00,}, // ';' 59
    {0x08,0x14,0x22,0x41,0x00,}, // '<' 60
    {0x14,0x14,0x14,0x14,0x14,}, // '=' 61
    {0x00,0x41,0x22,0x14,0x08,}, // '>' 62
    {0x02,0x01,0x51,0x09,0x06,}, // '?' 63
    {0x32,0x49,0x79,0x41,0x3E,}, // '@' 64
    {0x7E,0x11,0x11,0x11,0x7E,}, // 'A' 65
    {0x7F,0x49,0x49,0x49,0x36,}, // 'B' 66
    {0x3E,0x41,0x41,0x41,0x22,}, // 'C' 67
    {0x7F,0x41,0x41,0x22,0x1C,}, // 'D' 68
    {0x7F,0x49,0x49,0x49,0x41,}, // 'E' 69
    {0x7F,0x09,0x09,0x01,0x01,}, // 'F' 70
    {0x3E,0x41,0x49,0x49,0x3A,}, // 'G' 71
    {0x7F,0x08,0x08,0x08,0x7F,}, // 'H' 72
    {0x00,0x41,0x7F,0x41,0x00,}, // 'I' 73
    {0x20,0x41,0x41,0x3F,0x01,}, // 'J' 74
    {0x7F,0x08,0x14,0x22,0x41,}, // 'K' 75
    {0x7F,0x40,0x40,0x40,0x40,}, // 'L' 76
    {0x7F,0x02,0x0C,0x02,0x7F,}, // 'M' 77
    {0x7F,0x04,0x08,0x10,0x7F,}, // 'N' 78
    {0x3E,0x41,0x41,0x41,0x3E,}, // 'O' 79
    {0x7F,0x09,0x09,0x09,0x06,}, // 'P' 80
    {0x3E,0x41,0x51,0x21,0x5E,}, // 'Q' 81
    {0x7F,0x09,0x19,0x29,0x46,}, // 'R' 82
    {0x26,0x49,0x49,0x49,0x32,}, // 'S' 83
    {0x01,0x01,0x7F,0x01,0x01,}, // 'T' 84
    {0x3F,0x40,0x40,0x40,0x3F,}, // 'U' 85
    {0x1F,0x20,0x40,0x20,0x1F,}, // 'V' 86
    {0x3F,0x40,0x38,0x40,0x3F,}, // 'W' 87
    {0x63,0x14,0x08,0x14,0x63,}, // 'X' 88
    {0x07,0x08,0x70,0x08,0x07,}, // 'Y' 89
    {0x61,0x51,0x49,0x45,0x43,}, // 'Z' 90
    {0x00,0x7F,0x41,0x41,0x00,}, // '[' 91
    {0x02,0x04,0x08,0x10,0x20,}, // '\' 92
    {0x00,0x41,0x41,0x7F,0x00,}, // ']' 93
    {0x04,0x02,0x01,0x02,0x04,}, // '^' 94
    {0x40,0x40,0x40,0x40,0x40,}, // '_' 95
    {0x00,0x01,0x02,0x04,0x00,}, // '`' 96
    {0x20,0x54,0x54,0x54,0x78,}, // 'a' 97
    {0x7F,0x48,0x44,0x44,0x38,}, // 'b' 98
    {0x38,0x44,0x44,0x44,0x20,}, // 'c' 99
    {0x38,0x44,0x44,0x48,0x3F,}, // 'd' 100
    {0x38,0x54,0x54,0x54,0x18,}, // 'e' 101
    {0x08,0x7E,0x09,0x01,0x02,}, // 'f' 102
    {0x0C,0x52,0x52,0x52,0x3E,}, // 'g' 103
    {0x7F,0x08,0x04,0x04,0x78,}, // 'h' 104
    {0x00,0x44,0x7D,0x40,0x00,}, // 'i' 105
    {0x20,0x40,0x45,0x3C,0x00,}, // 'j' 106
    {0x7F,0x10,0x28,0x44,0x00,}, // 'k' 107
    {0x00,0x41,0x7F,0x40,0x00,}, // 'l' 108
    {0x7C,0x04,0x18,0x04,0x78,}, // 'm' 109
    {0x7C,0x08,0x04,0x04,0x78,}, // 'n' 110
    {0x38,0x44,0x44,0x44,0x38,}, // 'o' 111
    {0x7C,0x14,0x14,0x14,0x08,}, // 'p' 112
    {0x08,0x14,0x14,0x18,0x7C,}, // 'q' 113
    {0x7C,0x08,0x04,0x04,0x08,}, // 'r' 114
    {0x48,0x54,0x54,0x54,0x20,}, // 's' 115
    {0x04,0x3F,0x44,0x40,0x20,}, // 't' 116
    {0x3C,0x40,0x40,0x20,0x7C,}, // 'u' 117
    {0x1C,0x20,0x40,0x20,0x1C,}, // 'v' 118
    {0x3C,0x40,0x30,0x40,0x3C,}, // 'w' 119
    {0x44,0x28,0x10,0x28,0x44,}, // 'x' 120
    {0x0C,0x50,0x50,0x50,0x3C,}, // 'y' 121
    {0x44,0x64,0x54,0x4C,0x44,}, // 'z' 122
    {0x00,0x08,0x36,0x41,0x00,}, // '{' 123
    {0x00,0x00,0x7F,0x00,0x00,}, // '|' 124
    {0x00,0x41,0x36,0x08,0x00,}, // '}' 125
    {0x10,0x08,0x08,0x10,0x08,}, // '~' 126
    {0x08,0x1C,0x2A,0x08,0x08,} //  <-  127
};



//------------------------------------------------------
// Write Byte
//------------------------------------------------------
void PCD8544_Write_Byte(uint8_t data)
{
    for(uint8_t counter = 0; counter < 8; counter++) {
        if((data & 0x80)) {
            PIN_DIN_H;
        } else {
            PIN_DIN_L;
        }
        PIN_CLK_H;
        PIN_CLK_L;
        data <<= 1;
    }
}

//------------------------------------------------------
// Write Data
//------------------------------------------------------
void PCD8544_Write_Data(uint8_t data)
{
    PIN_DC_H;
    PCD8544_Write_Byte(data);
}

//------------------------------------------------------
// Write CMD
//------------------------------------------------------
void PCD8544_Write_CMD(uint8_t data)
{
    PIN_DC_L;
    PCD8544_Write_Byte(data);
}

//------------------------------------------------------
// PCD8544 Init
//------------------------------------------------------
void PCD8544_Init(uint8_t contrast)
{
    // set reset low
    PIN_RST_L;
    // wait a little amount of time
    PCD8544_Delay(DELAY_VALUE_ALL);
    // set reset high
    PIN_RST_H;

    // Extenden instructions and !powerdown
    // and horizontal adressing (autoincrement of x-adress)
    PCD8544_Write_CMD(PCD8544_FUNCTION_SET | PCD8544_FUNCTION_H);
    // Set Vop to 0x3F
    PCD8544_Write_CMD(PCD8544_VOP | contrast);
    // Vlcd temp. coeff. 0
    PCD8544_Write_CMD(PCD8544_TEMP_CONTROL);
    // Bias system 4, 1:48
    PCD8544_Write_CMD(PCD8544_BIAS | PCD8544_BIAS_BS1 | PCD8544_BIAS_BS0);
    // Set H = 0 for normal instructions
    PCD8544_Write_CMD(PCD8544_FUNCTION_SET);
    // Normal mode
    PCD8544_Write_CMD(PCD8544_DISPLAY_CONTROL | PCD8544_DISPLAY_CONTROL_NORMAL_MODE);
}

//------------------------------------------------------
// PCD8544 Display Cursor - Row_Y and Column_X
//------------------------------------------------------
void PCD8544_Display_Cursor(uint8_t Row_Y, uint8_t Column_X)
{
    PCD8544_Write_CMD(PCD8544_SET_Y_ADDRESS | (Row_Y & 0x07));
    PCD8544_Write_CMD(PCD8544_SET_X_ADDRESS | Column_X);
}

//------------------------------------------------------
// PCD8544 Line Position
//------------------------------------------------------
void PCD8544_Line_Position(uint8_t line_position)
{
    PCD8544_Display_Cursor(line_position, 0);
}

//------------------------------------------------------
// PCD8544 Display Clear
//------------------------------------------------------
void PCD8544_Display_Clear(void)
{
    PCD8544_Display_Cursor(0, 0);
    for (uint8_t y = 0; y < PCD8544_LINES; y++) {
       for (uint8_t x = 0; x < PCD8544_WIDTH; x++) {
         PCD8544_Write_Data(0);
       }
    }
    PCD8544_Display_Cursor(0, 0);
}

//------------------------------------------------------
// PCD8544 Write Char
//------------------------------------------------------
void PCD8544_Write_Char(uint8_t data)
{
    if(data >= ' ' && data <= 127)
    {
        for(uint8_t i = 0; i < 5; i++)
        {
            PCD8544_Write_Data(font6x8[data-' '][i] << 1);
        }
        PCD8544_Write_Data(0);
    }
}

//------------------------------------------------------
// PCD8544 Write Small Num
//------------------------------------------------------
void PCD8544_Write_SmallNum(uint8_t num, uint8_t shift)
{
    uint8_t i;
    for (i = 0; i < 4; i++)
    {
        PCD8544_Write_Data(small_num[num][i] << shift);
    }
}
